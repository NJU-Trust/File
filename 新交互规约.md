# 新交互规约

[TOC]

## 借款

### 得到基准利率

```json
url:"loan/rate"
method:GET

//param{
  //  "money":"double",
  // "returnDate":"double",
//}

return{
    "rate" : "double"
}
```

### 得到借款利率上下限

```json
url : "loan/rateRange"
method : GET

return {
    "lower" : "double",
    "upper" : "double"
}
```

### 得到借款期限建议范围

```json
url : "loan/timeRange"
method : GET

param {
    "money" : "double"
}

return {
    "lower" : "int",
    "upper" : "int"
}
```

### 得到还款方案详细数据

| url                 | 说明                   |
| ------------------- | ---------------------- |
| loan/repayment/ep   | 等额本金具体数据       |
| loan/repayment/eipi | 等额本息具体数据       |
| loan/repayment/otp  | 一次性还付本息具体数据 |
| loan/repayment/pi   | 先息后本具体数据       |

参数

| 名称         | 说明     |
| ------------ | -------- |
| money        | 借款金额 |
| duration     | 借款期限 |
| interestRate | 借款利率 |

返回值

| 名称        | 说明                                                         |
| ----------- | ------------------------------------------------------------ |
| interest    | 总利息                                                       |
| sum         | 还款总额                                                     |
| difficulty  | 还款难度，double类型，难度百分比                             |
| monthlyData | 每月还款数据（参见下表），返回形式为按照时间维度升序排列的列表 |
| note        | 还款注意事项（参见下表）                                     |

monthlyData 说明

| 名称               | 说明       |
| ------------------ | ---------- |
| sum                | 该月本息和 |
| interest           | 该月利息   |
| principal          | 该月本金   |
| remainingPrincipal | 剩余本金   |

note 说明

| 名称                | 说明                                                         |
| ------------------- | ------------------------------------------------------------ |
| exceedSurplus       | 是否有超出结余                                               |
| exceedSurplusMonths | 超出结余的具体月份列表，若没有超过结余，则此项为null         |
| exceedDisc          | 超过结余后是否超过可调部分                                   |
| discRatios          | 可调整支出分类占比列表：[衣物饰品 a%, 饮食 b%, 住宿 c% ,娱乐消费 d%]，结余未超出则为null |
| income              | 需要有额外收入的月份列表，可调未超出则为null                 |

```json
url : "loan/repayment/ep"
url : "loan/repayment/eipi"
url : "loan/repayment/otp"
url : "loan/repayment/pi"

method : GET

param {
    "money" : "double",
    "duration" : "int",
    "interestRate" : "double"
}

return {
    "interest" : "double",
    "sum" : "double",
    "difficulty" : "double",
    "monthlyData" : [
        {
            "sum" : "double",
            "principal" : "double",
            "interest" : "double",
            "remainingPrincipal" : "double"
        }
    ],
    "note" : {
        "exceedSurplus" : "boolean",
        "exceedSurplusMonths" : ["int", "int"],
        "exceedDisc" : "boolean",
        "discRatios" : ["double", "double", "double", "double"]
        "income" : ["int", "int", "int"]
    }
}
```

### 消费类小额短期借款

```json
url:"loan/borrow1"

method:GET

param{

	"username":"str",

	”targetType“:"str",

	"targetName":"str",

	"beginDate:"str",

	"endDate":"str",

	"usageCategory":"str",//资金用途分类

	"usageDiscription":"str",//资金用途详述

	"usageEvidence":"str",//资金用途证明，应该是图片，（这里是图片路径）

	"money":"double",//借款数目

	"returnDate":"double",//还款日期

	"rate":"double",//基准利率

	"returnWay":"str",//还款方式

}



//返回值是根据上面填写的借款标的生成的还款方案

return[

	{

		"difficulty":"int"//标识还款方案的难度，1星~5星

		“principal”:"double"//贷款本金

		"interest":"double"//利息

		“sum”:"double"//本息和

		“num”:"int"//还款期数，一次性还本付息为1期

		[{

			"s1":"double"//当期偿还的本息和

			“p1”:"double"//当期偿还的本金数

			“i1”:"double"//当期偿还的利息数

			“else”:"double"//剩余未偿还的本金数

		},

		.......

	],//该数组表示每期应还的钱，数组长度等于还款期数

        "suggestion":"str",//贷款建议，根据该用户当前填写的借款项目生成的贷款方案和历史记录预测生成

}	

]
```


### 学习培训类大额长期借款

```json

url:"loan/borrow2"

method:POST

param{

​	"username":"str",

​	”targetType“:"str",

​	"targetName":"str",

​	"beginDate:"str",

​	"endDate":"str",

    "usageDiscription":"str",//资金用途详述

    "usageEvidence":"str",//资金用途证明，应该是图片，（这里是图片路径）

    "money":"double",//借款数目

    "returnDate":"double",//还款时间

    "rate":"double",//基准利率

    "returnWay":"str",//还款方式

}

//返回值是根据上面填写的借款标的生成的还款方案

return[

	{

		"difficulty":"int"//标识还款方案的难度，1星~5星

		“principal”:"double"//贷款本金

		"interest":"double"//利息

		“sum”:"double"//本息和

		“num”:"int"//还款期数，一次性还本付息为1期

		[{

			"s1":"double"//当期偿还的本息和

			“p1”:"double"//当期偿还的本金数

			“i1”:"double"//当期偿还的利息数

			“else”:"double"//剩余未偿还的本金数

		},

		.......

	],//该数组表示每期应还的钱，数组长度等于还款期数

        "suggestion":"str",//贷款建议，根据该用户当前填写的借款项目生成的贷款方案和历史记录预测生成

}

]


```


### 查看我的借款项目
```json
url:"loan/check"

method:GET

param{

	"username":"str",

	"money":"double",

	"category":"str",

	"returnDate":"str"

}

return[

	{

	”targetType“:"str",

	"targetName":"str",

	"beginDate:"str",

	"endDate":"str",

	"usageCategory":"str",//资金用途分类

	"usageDiscription":"str",//资金用途详述

	"usageEvidence":"str",//资金用途证明，应该是图片，（这里是图片路径）

	“money”:"double",

	"returnDate":"double",

	"rate":"double",

	"returnWay":"str",

},{

	”targetType“:"str",

	"targetName":"str",

	"beginDate:"str",

	"endDate":"str",

	"usageCategory":"str",//资金用途分类

	"usageDiscription":"str",//资金用途详述

	"usageEvidence":"str",//资金用途证明，应该是图片，（这里是图片路径）

	“money”:"double",

	"returnDate":"double",

	"rate":"double",

	"returnWay":"str",

},

......

]

//后三个参数允许为空值，即0，""，""，都为空的时候返回这个人的所有借款项目
```


### 根据关键词查找
```json
url:"loan/search"

method:GET

param{

	"keyword":"str"

}

return[

	{

	”targetType“:"str",

	"targetName":"str",

	"beginDate:"str",

	"endDate":"str",

	"usageCategory":"str",//资金用途分类

	"usageDiscription":"str",//资金用途详述

	"usageEvidence":"str",//资金用途证明，应该是图片，（这里是图片路径）

	“money”:"double",

	"returnDate":"double",

	"rate":"double",

	"returnWay":"str",

},{

	”targetType“:"str",

	"targetName":"str",

	"beginDate:"str",

	"endDate":"str",

	"usageCategory":"str",//资金用途分类

	"usageDiscription":"str",//资金用途详述

	"usageEvidence":"str",//资金用途证明，应该是图片，（这里是图片路径）

	“money”:"double",

	"returnDate":"double",

	"rate":"double",

	"returnWay":"str",

},

......

]
```

### 标的排序、筛选、推荐

| url                    | 功能                                           |
| ---------------------- | ---------------------------------------------- |
| loan/interstRate       | 返回筛选条件中“利率”的可选择范围               |
| loan/largetTargetList  | 返回符合条件的大额标的列表                     |
| loan/smallTargetList   | 返回符合条件的小额标的列表                     |
| loan/recommendSmall    | 返回符合条件的推荐的8个标的（也有可能少于8个） |
| loan/recommendStrategy | 返回对推荐的8个标的投资的策略                  |

- 小额标的排序维度

  | 名称              | 说明             |
  | ----------------- | ---------------- |
  | money             | 标的金额         |
  | startTime         | 开始时间         |
  | interestRate      | 利率             |
  | repaymentDuration | 还款期限         |
  | userCreditScore   | 用户信用分数     |
  | targetRatingScore | 标的风险评级分数 |

  小标的筛选条件

  | 名称              | 说明                                     |
  | ----------------- | ---------------------------------------- |
  | money             | 金额，Double                             |
  | startTime         | 开始时间，格式为 "2018-08-22T10:00:00"   |
  | interestRate      | 利率，百分比                             |
  | repaymentDuration | 还款期限，整数                           |
  | userCreditRating  | 用户信用评级，多选，[AA, A, B, C, D]     |
  | classification    | 标的分类，见小额标的 classification 说明 |
  | targetRating      | 标的风险评级，多选，[A, B, C, D]         |

- 大额标的排序维度 

  | 名称              | 说明         |
  | ----------------- | ------------ |
  | money             | 标的金额     |
  | startTime         | 开始时间     |
  | interestRate      | 利率         |
  | repaymentDuration | 还款期限     |
  | userCreditScore   | 用户信用分数 |

  大额标的筛选条件

  | 名称               | 说明                                     |
  | ------------------ | ---------------------------------------- |
  | money              | 金额，Double                             |
  | startTime          | 开始时间，格式为 "2018-08-22T10:00:00"   |
  | interestRate       | 利率，百分比                             |
  | repaymentDuration  | 还款期限，整数                           |
  | userCreditRating   | 用户信用评级，多选，[AA, A, B, C, D]     |
  | classification     | 标的分类，见大额标的 classification 说明 |
  | userFailedSubjects | 用户挂科数                               |
  | userRankingRate    | 排名率，百分比                           |

- 小额标的 classification 说明

  | 名称                       | 说明                         |
  | -------------------------- | ---------------------------- |
  | DAILY_EXPENSE              | 日常费用                     |
  | CONCERT                    | 演唱会看比赛看剧音乐会等     |
  | GAME_MOVIE_MUSIC           | 游戏娱乐电影音乐             |
  | TRAVEL                     | 旅游                         |
  | ELECTRONIC_DEVICE          | 购买电子设备                 |
  | OTHER                      | 其他购买项比如化妆品衣服鞋   |
  | TEST_TRANSCRIPT            | 出国所需考试的相关成绩单     |
  | CERTIFICATE_TEST           | 各类考证                     |
  | TRAIN                      | 外出学习培训的培训证明或信息 |
  | PROFESSIONAL_QUALIFICATION | 职业资格证                   |
  | EXCHANGE_PROJECT           | 交换生                       |

- 大额标的 classification 说明

  | 名称             | 说明     |
  | ---------------- | -------- |
  | CERTIFICATE_TEST | 大额考证 |
  | EXCHANGE_PROJECT | 交换生   |
  | GMAT             |          |
  | TOEFL            |          |
  | IELTS            |          |

- 其他说明

  - page 从 0 开始计数
  - 区间中用 null 表示没有界限，比如 [0, null] 表示 0 到 正无穷

```json
url : "loan/interestRate"
method : GET
return
{
    "low" : "double", // 百分比
    "high" : "double"
}

// 大额标的列表
url : "loan/largeTargetList"
method : GET
param {
    "sort" : "money|startTime|interestRate|repaymentDuration(,asc|desc)",
    // 可以用null表示没有界限
    "money" : [0, 0], 
    "time" : ["", ""],
    "interestRate" : [0, 0],
    "repaymentDuration" : [0, 0],
    "userFaildSubjects" : [0, 0],
    "userCreditRating" : ["AA", "A", "B"],
    "userRankingRate" : [0., 100.],
    "classification" ： []
    "page" : "integer", // 从0开始
    "size" : "integer"
}

return
[
    {
        "id" : "long",
        "username" : "str",
        "startTime" : "2018-08-26T11:00:00",
        "name" : "str",
        "money" : "double",
        "collectedMoney" : "double",
        "state" : "ON_GOING|PENDING|COMPLETED|PAY_OFF",
        "completionRate" : "double",
        "interestRate" : "double",
        "riskRating" : "A|B|C|D",
        "projectDescription" : "str",
        "classification" : "CERTIFICATE_TEST|EXCHANGE_PROJECT|GMAT|TOEFL|IELTS"
    }
]

// 小额标的列表
url : "loan/smallTargetList"
method : GET

param {
    "sort" : "money|startTime|interestRate|repaymentDuration|userCreditScore|targetRatingScore(,asc|desc)",
    "money" : [0, 0], 
    "time" : ["", ""], 
    "interestRate" : [0, 0],
    "repaymentDuration" : [0, 0],
    "userCreditRating" : ["AA", "C"],
    "classification" : [],
    "targetRating" : [],
    "page" : "integer",
    "size" : "integer",
}

return 
// 同上

// 标的推荐
url : "loan/recommendSmall" // 第一类标的推荐
param
{
    "money" : [0, 0], 
    "time" : ["", ""],
    "interestRate" : [0, 0],
    "repaymentDuration" : [0, 0],
    "userFaildSubjects" : [0, 0],
    "userCreditRating" : ["AA", "A", "B"],
    "userRankingRate" : [0., 100.],
    "classification" ： [],
    "targetRating" : ["A", "B"]
}

return  // 只会返回8个
[
    {
        "id" : "long",
        "username" : "str",
        "startTime" : "2018-08-26T11:00:00",
        "name" : "str",
        "money" : "double",
        "collectedMoney" : "double",
        "state" : "ON_GOING|PENDING|COMPLETED|PAY_OFF",
        "completionRate" : "double",
        "interestRate" : "double",
        "riskRating" : "A|B|C|D",
        "projectDescription" : "str",
        "classification" : "CERTIFICATE_TEST|EXCHANGE_PROJECT|GMAT|TOEFL|IELTS",
    }
]

url : "loan/recommendStrategy"

param {
    "money" : "double", // 预计投入金额
    "expectedInterestRate" : "double", // 收益目标利率，百分制
    "targets" : ["id", "id", "id", "id", "id", "id", "id", "id"] // 上个url返回的8个标的的id
}

return
[
    {
        "id" : "long",
        "investmentRatio" : "double", // 投资比例，百分制
        "investmentMoney" : "double" // investmentMoney = 投资比例 * 投入金额
    }
]
```


## 个人中心

### 个人信息查看

- grade 采用整型
- major 采用枚举类还是用字符串后端待讨论

```json
url : "profile/details"
method : GET

param
{
    "username" : "str"
}

return
{
  //个人资料
  "username": "",
  "name": "",
  "sex": "",
  "age": "",
  "picture": "url",  // avatar
  "email": "",
  "phone": "",
  "grade": 2016,
  "major": "enum2str",
  "level": "UserLevel",
  "stuNum": "str", // 学号
  "stuId": "str", // 身份证
  "alipay": "str", //支付宝账号
  "comment": "str",
  "address": "str",
  "favoriteTargets": [0], // 数组中的数字是标的的编号
  "participatingTargets": [0],
  "creditCheck": [
    {
      "currentCheck": "UserLevel",
      "appliedCheck": "UserLevel",
      "state": "CheckState"
    }
  ],
  //信用状况
  "totalRating": "", //总评
  //此处需要近几个月的总评数据
}
```

### 财务状况

```json
url : "database" //先简单分类 收入/支出/其他 

param{
    "username" : "str"
}

//此处根据后端数据分析代码的变量名来命名
return{

    //收入数据
    "income_m" : "", //月收入
    "income_all" : "", //总收入
    "" : "", //根据需求，还需要每日的数据

    //支出数据
    "expense_m" : "", //月支出
    "expense_all" : "", //总支出
    "expense_rig_m" : "", //月刚性支出
    "expense_rig_all" : "", //总刚性支出
    "expense_disc_m" : "", //月可调度支出
    "expense_disc_all" : "", //总可调度支出
    "expense_daily_m" : "", //月日常
    "expense_daily_all" : "", //总日常
    "expense_food_m" : "", //月饮食
    "expense_food_all" : "", //总饮食
    "expense_trvl_m" : "", //月出行
    "expense_trvl_all" : "", //总出行
    "expense_ntrt_m" : "", //月娱乐
    "expense_ntrt_all" : "", //总娱乐
    "lblt_m" : "", //月负债
    "lblt_all" : "", //总负债

    //其他数据
    "ivstm_m" : "", //总投资
    "surplus_m" : "", //月结余
    "surplus_all" : "", //总结余
    "asset" : "", //净资产
    "engel" : "", //恩格尔系数
    "rig_ratio" : "", //刚性比率
    "^2all" : "", //各支出占总支出比例
    "d2a_ratio" : "", //资产负债率
    "dp_ability" : "", //偿债能力
    "leverage" : "", //杠杆比率
    "consump_ratio" : "", //月消费比率
    "saving_ratio" : "", //月储蓄比率
    //此处还需要一些比较零碎的，什么食堂，外卖啥的。
    //数据库里有的话就先不写了，有点儿乱了
    
    //信用状况
    "totalRating": "", //总评
    //此处需要近几个月的总评数据

}

```



### 账号升级申请(信用验证)

```json
//中级账号
url : "user/apply/intermeidate"

param
{
    "stuId" : "xxx",
    "stuCardImage" : MultiPartFile, //学生证和校园卡
    "major" : "xxx",
    "grade" : 2016
}
```

```json
//完整账号
url : "user/apply/advanced"

param
{
    "alipayId" : "",
    "bankId" : "",
    "financialDatas" : MultiPartFile,//银行卡和支付宝数据，以及非结构化数据
    //此处还有关系网交叉检验数据，暂时不知道怎么得到
}
```

```json
//校友账号
url : "user/apply/school"

param
{
    "username" : "",
    "schoolCardImage" : MultiPartFile, //毕业证书和学位证书
}
```

### 我的项目和历史统计

- 第一个 url 是查看现在正在进行的标的
- 第二个 url 是查看历史标的
- 第三个 url 是查看收藏的标的(我的投资和融资)
- 三个 url 的 param 和 return 都是一样的

```json
url : "profile/ongoingtarget"
method : GET

url : "profile/historytarget"
method : GET

url : "profile/favoritetarget"
method : GET

param
{
    "username" : "str"
}

return
[
    {
        "targetName" : "str",
        "applicant" : "str", // 申请人用户名
        "targetType" : "TargetType",
        "targetId" : 0
    },
    {
        // 同上
    }
]
```





## 管理员

### 登录

```json
url : "admin/signin"
method : GET

param
{
    "username" : "str",
    "password" : "str"
}

return
{
    "state" : "state",
    "message" : "null|str",
}
```

### 用户管理

#### 查看用户列表信息
```json
url : "admin/usermanage"
method : GET

param
{
    
}
//返回所有
return
{
  [
  "username": "",
  "state": "",//无借款 待还款 逾期用户
  "level": "UserLevel",//信用评级
  "tel": "",
  "email": "",
  ]
  
}
```
#### 查看某用户详细信息

使用已有的交互即可：

1、查看个人投资历史
2、查看个人借款标的
3、查看个人财务情况

### 审核页面

#### 用户信息审核

```json
Url:”admin/userlist”                           //获取待审核的用户列表，分页显示

method:GET

param

{
  "page" : 1,
  "pageSize" : 20,
}

Return                                                    

{

“username”:””,                           //用户名

“checkstate”:”CheckState”,     //用户审核状态

}


Url:”admin/userpendingitem”         //审核用户非结构化信息

method:GET

param

{

“username”:”str”,                      //上页选定的某个用户

}

Return                                                    

{

“files”:[

{

“type”:”str”,                        //图片类别

“file”:file  ,                           

“state”:”CheckState”,       //类别审核状态

}]

}

url : "admin/usercheck"          //用户信息审核结果

method : GET

param

{

    "username" : “str”,

    "pass" : true

}

return

{

    "state" : "state",

    "message" : "null|str"

}
```



#### 标的审核

```json
url : "admin/pendinglist"        //获取待审核标的列表，分页显示

method : GET

param

{

"page" : 1,

"pageSize" : 20,

"targetType" : “TargetType”,

}

Return                           //标的简介

[

    {

        "username" : "str",       

        "creditRating" : "credit_rating",

        "targetId" : 0

“targetState”:”TargetState”,           //标的审核状态


    },

    {

        "username" : "str",

        "creditRating" : "credit_rating",

        "targetId" : 0


“targetState”:”TargetState”,           //标的审核状态

    }

]



url : "admin/targetpendingitem"  //审核标的

method : GET

param

{

    "target_id" : 0,

}

Return                           //标的详情

{

    "name" : "str",

    "creditRating" : "credit_rating",

    "major" : "str",

    "grade" : "str",

    "advice" : "str",

    "targetType" : "target_type",

    "money" : 0.0,

    "startTime" : "formal",

    "endTime" : "formal",

    "returnTime" : "formal",  

    "purpose" : "enum2str",

    "explanation" : "str", 

    "incomeSituation" : "str", 

    "targetRating" : "target_rating",  

    "risk" : "str"                        

}



url : "admin/targetcheck"        //标的审核结果

method : GET

param

{

    "targetId" : 0,

    "pass" : true

}

return

{

    "state" : "state",

    "message" : "null|str"

}


```
### 数据统计

```json

url：admin/basestatistics

method：GET

基础数据： 每日更新一次

param

{

"username":"str"

}

return

{

"total":[

{

"amount":"str",

"frequency":"str",

"borrowers":"str,

"investors":"str"

}

]

 

"average":[

{

"cumBorrowPer":"str",

"borrowTrans":"str",

"cunInvestPer":"str"

}

]

 

"other":[

{

  "maxBorrowRemain"：“str”，

 "maxTenBorrowRemain":"str",

"averageFull":  "str"

}

]

 

}

url:admin/breakcontract

mothod: GET

违约信息，每月更新一次

param

{

"username":"str"

}

 

return

{

"cumDefaultRatio":"str",

"defaultProgram":"str",

"defaultProgramsThree":"str",//近三个月项目逾期率

"defaultAmount":"str",

"toClaimAmount":"str",

"defaultRatio":"str",

"badDebtRate":"str",

"complaint":"str"

}
```
### 管理页面

#### 标的管理

```
url : "admin/investManager"        //获取标的列表，分页显示

method : GET

param
{
	"page" : 1,
	"pageSize" : 20,
	"targetType" : “TargetType”,
	"targetState" : "targetState",
}

Return                           //标的简介
[
    {
    	"targetId" : 1, //标的编号
        "username" : "str",	//借款用户
        "username" : "str", //投资用户
        "creditRating" : "credit_rating",
    },
]



url : "admin/targetManageItem"  //标的详情

method : GET

param
{
    "target_id" : 0,
}

Return                           //标的详情
{
    "username" : "str",
    "startTime" : "formal",
    "endTime" : "formal",
    "money" : 0.0,
    "receivedMoney" : 0.0,
    "explanation" : "str", 
    "targetState" : "targetState",
    "incomeSituation" : "str", 
    "targetRating" : "target_rating",  
    "risk" : "str",
    "returnSolution" : "str", //还款方案
    "remarks" : "str"
}

url : "admin/targetcheck"        //标的审核结果

method : SET

param
{
    "targetId" : 0,
    "state" : "state",
    "message" : "null | str"
}

return
{
}
```

## 其他

### 图片上传

```json
url : "/upload/image"

param
image : "MultipartFile"

return
"image url"
```

