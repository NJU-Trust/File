# 交互规约

## 修改记录

| 时间      | 修改人 | 简单描述 |
| --------- | ------ | -------- |
| 2018-7-25 | 廖均达 | 完成初稿 |

## 需要定义的枚举类型

| 类型            | 值                               | 解释                                                         |
| --------------- | -------------------------------- | ------------------------------------------------------------ |
| TargetType      | SMALL\|LARGE                     | 标的类型                                                     |
| TargetRating    | unknown                          | 平台对项目的综合评级                                         |
| CreditRating    | unknown                          | 用户的信用等级                                               |
| State           | SUCCESS\|FAILURE                 | 各种操作的结果，分为成功和失败                               |
| InterestPlan    | HIGH\|LOW\|ZERO                  | 利息方案，分别是高利息、低利息、0利息                        |
| UserLevel       | ONE\|TWO\|THREE\|SF              | 账号等级，分别是ONE(初级)，TWO(中级)，THREE(完整)，SF(校友)  |
| CheckState      | ONGOING\|PASS\|REJECT            | 审核结果，分别是审核中、通过、拒绝                           |
| UsePurpose      | unknown                          | 资金用途分类                                                 |
| TargetState     | ONGOING\|PENDING\|EXPIRED        | 标的的状态，分别是正在进行，正在审核，失效                   |
| IdentityOptions | NONE\|ALL\|NAME\|BASIC\|SCHOOL\| | 创建标的时用户需要选择身份透明化程度，分别是匿名、全部、名称、基础信息（包括名、电话、邮箱）、学校信息（包括学校、专业、年级、学号） |

## 个人中心

### 个人信息查看

- grade 采用整型
- major 采用枚举类还是用字符串后端待讨论

```json
url : "profile/details"
method : GET

param
{
    "username" : "str"
}

return
{
  "username": "",
  "name": "",
  "picture": "url",
  "email": "",
  "phone": "",
  "grade": 2016,
  "major": "enum2str",
  "level": "UserLevel",
  "stu_num": "str", // 学号
  "stu_id": "str", // 身份证
  "comment": "str"
  "fav_targets": [0], // 数组中的数字是标的的编号
  "par_targets": [0],
  "credit_check": [
    {
      "current_check": "UserLevel",
      "applied_check": "UserLevel",
      "state": "CheckState"
    }
  ]
}
```

### 项目查看

说明

- 第一个 url 是查看现在正在进行的标的
- 第二个 url 是查看历史标的
- 第三个 url 是查看收藏的标的
- 三个 url 的 param 和 return 都是一样的

```json
url : "profile/ongoingtarget"
method : GET

url : "profile/historytarget"
method : GET

url : "profile/favoritetarget"
method : GET

param
{
    "username" : "str"
}

return
[
    {
        "target_name" : "str",
        "applicant" : "str", // 申请人用户名
        "target_type" : "TargetType",
        "target_id" : 0
    },
    {
        // 同上
    }
]
```

### 项目详情

说明

- 由于两种标的存在不同的信息，所以不同的标的会返回不同的字段，需要前端根据返回的类型进行解析

```json
url : "target/details"
method : GET

param
{
    "target_id" : 0,
}

return
// 小额短期标的
{
    "target_type": "TargetType",
    "username": "str",
    "start_time": "formal",
    "end_time": "formal",
    "name": "str", // 标的名称
    "money": 0.,
    "collected_money": 0.,
    "granted_money": 0.,
    "state": "TargetState",
    "purpose": "UsePurpose",
    "rate": 0, // 完成度限制
    "progress": 0,  // 筹款进度
    "income": "str", // 收益情况
    "risk": "str"
}

// 大额长期标的
{
    "target_type": "TargetType",
    "username": "str",
    "start_time": "formal",
    "end_time": "formal",
    "name": "",
    "money": 0,
    "collected_money": 0,
    "granted_money": 0,
    "state": "TargetState",
    "files" : [
        file1, file2
    ],  // 官方文件、项目说明等文件的url
    "explanation" : [
        {
            "type" : "str", // 类目介绍
            "money" : 0. // 金额
        }
    ], // 每笔费用的类目介绍和金额
    "repay_plan": "",
    "repay_approach": ""
    "rate": 0,
    "progress": 0,
    "income": "str",
    "risk": "str",
}
```

### 创建标的

说明

- 第一个 url 是创建小额短期标的，第二个 url 是创建大额长期标的
- 创建小额短期标的，填写资金用途，如果没有上传的文件，则 "purpose_files" 为空数组

```json
url : "target/createsmall"
method : POST

param
{
    "target_type": "TargetType",
    "username": "str",
    "start_time": "formal",
    "end_time": "formal",
    "name": "str", // 标的名称
    "money": 0.,
    "collected_money": 0.,
    "granted_money": 0.,
    "state": "TargetState",
    "purpose": "UsePurpose",
    "purpose_files" : [
        file1, file2
    ], // 解释文件
    "rate": 0, // 完成度限制
    "progress": 0,  // 筹款进度
    "income": "str", // 收益情况
    "risk": "str",
    "identity_options" : "IdentityOptions"
}

url : "target/createlarge"
method : GET

param
{
    "target_type": "TargetType",
    "username": "str",
    "start_time": "formal",
    "end_time": "formal",
    "name": "",
    "money": 0,
    "collected_money": 0,
    "granted_money": 0,
    "state": "TargetState",
    "files" : [
        "url1", "url2"
    ],  // 官方文件、项目说明等文件的url
    "explanation" : [
        {
            "type" : "str", // 类目介绍
            "money" : 0. // 金额
        }
    ], // 每笔费用的类目介绍和金额
    "repay_plan": "",
    "repay_approach": ""
    "rate": 0,
    "progress": 0,
    "income": "str",
    "risk": "str",
    "identity_options" : "IdentityOptions"
}
```

## 投资页面

### 投资项目概要信息显示

说明：

- 在没有按照维度进行排序的情况下，系统返回的是推荐的结果

```json
url : "investment/all"
method : GET

param  // 项目的排序维度，不需要过滤的维度传值null
{
    "target_type" : "target_type",
    "start_time" : "formal",
    "end_time" : "formal",
    "target_rating" : "target_rating"，
    "progress" : 0.0,  // 完成度
    "money" : 0.0,
    "yield" : 0.0, // 收益率
    "descent" : bool  // 是否降序
}

return
[
    {
        "name" : "str", // 申请人姓名
        "credit_rating" : "credit_rating",
        "target_type" : "target_type",
        "target_id" : 0
    },
    {
        "name" : "str",
        "credit_rating" : "credit_rating",
        "target_type" : "target_type",
        "target_id" : 0
    },
    ...
]
```

### 查看详细投资信息

说明：

- 返回值待添加近期财务状况以及分析

```json
url : "investment/detail"
method : GET

param
{
    "target_id" : 0,
}

return
{
    "name" : "str",
    "credit_rating" : "credit_rating",
    "major" : "str",
    "grade" : "str",
    "advice" : "str",
    "target_type" : "target_type",
    "money" : 0.0,
    "start_time" : "formal",
    "end_time" : "formal",
    "return_time" : "formal",  // 还款时间
    "purpose" : "enum2str",
    "explanation" : "str", // 资金去向说明
    "income_situation" : "str", // 收益情况
    "target_rating" : "target_rating",  // 平台综合评级
    "risk" : "str" // 风险分析及意见
}
```

### 进行投资

说明：

- 这个版块传递的参数待定，可能结合了花旗杯官方的api后会有所改变
- 这个版块有两个 url ，访问第一个 url 进行正常投资，若返回值中的 `is_schoolfellow` 为 `true` ，则选择利息方案后访问第二个 url

```json
url : "investment/invest"
method : POST

param
{
    "money" : 0.,
    "username" : "str",
}

return
{
    "state" : "result",
    "message" : "null|str", // state 为失败才有message
    "is_schoolfellow" : true
}

url : "investment/sfinvest"
method : POST

param
{
    "username" : "str",
    "interest_plan" : "str"
}

return
{
    "state" : "result",
    "message" : "null|str", // state 为失败才有message
}
```

### 校友资金投入排行榜

说明：

- 直接访问 url ，没有参数，返回的是一个 json 数组，按照名次排列

```json
url : "investment/leaderboard"
method : GET

return
[
    {
        "avatar" : "url",
        "name" : "str"
    },
    {
        "avatar" : "url",
        "name" : "str"
    }
]
```

## 管理员

### 登录

```json
url : "admin/signin"
method : GET

param
{
    "username" : "str",
    "password" : "str"
}

return
{
    "state" : "state",
    "message" : "null|str",
}
```

### 用户管理

#### 查看某用户详细信息

```json
url : "admin/user"
method : GET

param
{
    "username" : "str"
}

return
{
    // 同个人信息处
}
```

#### 搜索用户

```json
url : "admin/search"
method : GET

param
{
    "keyword" : "str"
}

return
[
    {
        "username" : "str"
    }
]
```

#### 增加用户

- 管理员增加用户时，是否验证手机邮箱待定

```json
url : "admin/adduser"
method : POST

param
{
    "username" : "str",
    "password" : "str",
    "email" : "str",
    "phone_number" : "str"
}

return
{
    "state" : "state",
    "message" : "null|str"
}
```

#### 删除用户

危险操作

```json
url : "admin/deleteuser"
method : GET

param
{
    "username" : "str"
}

return
{
    "state" : "state",
    "message" : "null|str"
}
```

#### 修改用户

说明

- 初步认为修改用户的信息只能一项一项地进行修改，所以对每一项信息的修改对应一个url
- 目前只规定了修改密码和用户名
- 返回值采用统一格式

```json
url : "admin/changepwd"
method : POST

param
{
    "username" : "str",
    "new_password" : "str"
}

url : "admin/changeusername"
method : POST

param
{
    "old_username" : "str",
    "new_username" : "str"
}

return
{
    "state" : "state",
    "message" : "null|str"
}
```

### 项目审核

#### 待审核列表

说明

- 待审核的项目可能很多，以页的形式来获取数据，页从1开始编号，每页默认20项
- pendinglist 返回的是标的的简略信息

```json
url : "admin/pendinglist"
method : GET

param
{
    "page" : 1,
    "page_size" : 20
}

return
[
    {
        "name" : "str", // 申请人姓名
        "credit_rating" : "credit_rating",
        "target_type" : "target_type",
        "target_id" : 0
    },
    {
        "name" : "str",
        "credit_rating" : "credit_rating",
        "target_type" : "target_type",
        "target_id" : 0
    }
]

url : "admin/pendingitem"
method : GET

param
{
    "target_id" : 0,
}

return
{
    "name" : "str",
    "credit_rating" : "credit_rating",
    "major" : "str",
    "grade" : "str",
    "advice" : "str",
    "target_type" : "target_type",
    "money" : 0.0,
    "start_time" : "formal",
    "end_time" : "formal",
    "return_time" : "formal",  // 还款时间
    "purpose" : "enum2str",
    "explanation" : "str", // 资金去向说明
    "income_situation" : "str", // 收益情况
    "target_rating" : "target_rating",  // 平台综合评级
    "risk" : "str" // 风险分析及意见
}

url : "admin/check"
method : GET

param
{
    "target_id" : 0,
    "pass" : true
}

return
{
    "state" : "state",
    "message" : "null|str"
}
```

### 项目管理

#### 修改项目信息

待定

#### 删除项目

```json
url : "admin/deleteitem"
method : GET

param
{
    "target_id" : 0,
}

return
{
    "state" : "state",
    "message" : "null|str"
}
```

### 选择算法

待定